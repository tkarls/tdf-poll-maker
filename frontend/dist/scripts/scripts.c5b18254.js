"use strict";function WinnersThreadController(a,b,c,d,e){function f(){return a.post("/api/parse/forum-polls").then(function(a){b.months=a.data})["catch"](function(a){e.error(a)}).then(function(){})}b.storage=c,b.loadWinners=function(c){return b.loadingWinners=!0,b.data={numWinners:3},a.post("/api/parse/poll-thread",{threadUri:c}).then(function(a){b.winners=a.data.map(function(a){return a})})["catch"](function(a){e.error(a)}).then(function(){b.loadingWinners=!1,d(function(){},1e3)})},b.getNumumWinnersWithTies=function(){if(!b.winners)return b.data.numWinners;var a=b.data.numWinners,c=0,d=0,e=0;return b.winners.forEach(function(b){d!==b.votes&&(a--,e++),a>=0&&c++,d=b.votes,b.place=e}),c};var g=function(a){return a?a.trim().replace(/^\"|\"$/g,""):"unknown"};b.getAllWinnerBbCode=function(){var a=b.winners.slice(0,b.getNumumWinnersWithTies()).reverse(),c={1:"First",2:"Second",3:"Third",4:"Fourth",5:"Fifth"},d={1:200,2:180,3:160},e={1:"#FBDB21",2:"#919191",3:"#DA7726"},f="[center]\n";return a.forEach(function(a){f+="[size="+(d[a.place]||150)+"]",f+="In [color="+(e[a.place]||"#000000")+"]"+(c[a.place]||a.place.toString()+":th")+" place[/color], with [b]"+a.votes+" votes[/b]\n",f+="[b][color=#FF00FF]"+g(a.dollName)+'[/color][/b] in [color=#FF0000]"'+g(a.caption)+'"[/color]\n',f+="by [i]"+g(a.contestant)+"[/i]\n",f+="[img600]"+a.imageUri+"[/img600]\n",f+="[/size]\n\n\n\n\n\n"}),f=f.trim(),f+="[/center]"},f()}function winnersThread(){return{templateUrl:"views/winnersThread.html",restrict:"EA",scope:{},controller:WinnersThreadController,controllerAs:"vm",bindToController:!0}}function ContestThreadController(a,b,c,d,e){function f(){return a.post("/api/parse/forum-page").then(function(a){b.months=a.data})["catch"](function(a){e.error(a)}).then(function(){})}b.storage=c,b.loadCandidates=function(f){return b.loadingCandidates=!0,a.post("/api/parse/entry-thread",{threadUri:f}).then(function(a){b.candidates=a.data.map(function(a){var b=f+a.postAuthor+a.postBody.images[0];return a.storageKey=b,c[b]=c[b]||{isIncluded:!0},c[b].imageSelectionIndex=c[b].imageSelectionIndex||0,a})})["catch"](function(a){e.error(a)}).then(function(){b.loadingCandidates=!1,d(function(){},1e3)})};var g=function(a){return a?a.trim().replace(/^\"|\"$/g,""):"unknown"};b.getBbCode=function(a){var b=c[a.storageKey];return"[center][list][size=140][color=#EFF7FB][*][*][*][*]*[/color][b][color=#FF00FF]"+g(b.dollName)+'[/color] [color=#000000]in[/color] [color=#0040FF]"'+g(b.caption)+'" [/color][/b][color=#EFF7FB][*]*[/color][i][color=#000000]by '+a.postAuthor+"[/color][/i][/size][color=#EFF7FB][*]*[/color][color=#EFF7FB][*][img600]"+a.postBody.images[b.imageSelectionIndex]+"[/img600][/color][/list][/center]"},b.getAllBbCode=function(){var a="";return(b.candidates||[]).forEach(function(d){c[d.storageKey].isIncluded&&(a+=b.getBbCode(d)+"\n")}),a.trim()},b.getNumEntries=function(){return b.candidates?b.candidates.filter(function(a){return c[a.storageKey].isIncluded}).length:0},f()}function contestThread(){return{templateUrl:"views/contestThread.html",restrict:"EA",scope:{},controller:ContestThreadController,controllerAs:"vm",bindToController:!0}}angular.module("tdfPollMakerApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngMaterial","ngclipboard","ngStorage"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl",controllerAs:"main"}).otherwise({redirectTo:"/"})}]).config(["$locationProvider",function(a){a.html5Mode(!0).hashPrefix("*")}]),angular.module("tdfPollMakerApp").controller("MainCtrl",function(){}),WinnersThreadController.$inject=["$http","$scope","$localStorage","$timeout","$log"],angular.module("tdfPollMakerApp").directive("winnersThread",winnersThread),ContestThreadController.$inject=["$http","$scope","$localStorage","$timeout","$log"],angular.module("tdfPollMakerApp").directive("contestThread",contestThread).filter("highlight",["$sce","$localStorage",function(a,b){return function(c,d){var e=new RegExp(/((?:[A-Z][a-zA-Z_\-0-9]+ )?(?:[A-Z][a-zA-Z_\-0-9]+ and )?[A-Z][a-zA-Z_\-0-9]+) (?:i|I)n.{0,4}(?:"|'')([a-zA-Z0-9!?.,' -_~]+)(?:"|'')/),f=c.match(e);return f&&(b[d.storageKey].dollName||(b[d.storageKey].dollName=f[1]),b[d.storageKey].caption||(b[d.storageKey].caption=f[2])),c=c.replace(e,'<span class="highlighted">$1</span> in "<span class="highlighted">$2</span>"'),a.trustAsHtml(c)}}]),angular.module("tdfPollMakerApp").run(["$templateCache",function(a){a.put("views/WinnersThread.html",'<div layout="column" ng-if="months"> <md-input-container> <label>Select your poll thread</label> <md-select ng-model="storage.pollUri" aria-label="select the poll thread" required> <md-optgroup ng-repeat="month in months" label="{{month.name}}"> <md-option ng-repeat="thread in month.threads" ng-value="thread.uri">{{thread.name}}</md-option> </md-optgroup> </md-select> </md-input-container> <div> <md-button class="md-primary md-raised" ng-click="loadWinners(storage.pollUri)" ng-disabled="loadingWinners">Get the winners</md-button> </div> </div> <div ng-if="!months"> <p>Loading poll threads...</p> </div> <div ng-if="loadingWinners"> <p>Loading thread data...</p> </div> <div class="winner-list" ng-if="winners"> <md-input-container> <label>Number of winners</label> <md-select ng-model="data.numWinners" aria-label="select number of winners" required> <md-option ng-value="3">Top 3</md-option> <md-option ng-value="5">Top 5</md-option> <md-option ng-value="999999">All</md-option>  </md-select> </md-input-container> <table> <tr> <th>Contestant</th> <th>Doll name(s)</th> <th>Caption</th> <th>Image</th> <th>Number of votes</th> </tr> <tr ng-repeat="winner in winners | limitTo: getNumumWinnersWithTies(numWinners)" class="winner"> <td> <md-input-container> <label>Contestant</label> <input type="text" ng-model="winner.contestant"> </md-input-container> </td> <td> <md-input-container> <label>Doll name(s)</label> <input type="text" ng-model="winner.dollName"> </md-input-container> </td> <td> <md-input-container> <label>Caption</label> <input type="text" ng-model="winner.caption"> </md-input-container> </td> <td> <img ng-src="{{winner.imageUri}}"> </td> <td> {{winner.votes}} </td> </tr> </table> </div> <div class="bb-code" ng-if="winners"> <md-button ngclipboard data-clipboard-target="#all-winner-bb-code">Copy to clipboard</md-button> <div> <textarea readonly id="all-winner-bb-code" ng-value="getAllWinnerBbCode()">\r\n            </textarea> </div> </div>'),a.put("views/contestThread.html",'<div layout="column" ng-if="months"> <md-input-container> <label>Select your contest thread</label> <md-select ng-model="storage.tdfUri" aria-label="select the contest thread" required> <md-optgroup ng-repeat="month in months" label="{{month.name}}"> <md-option ng-repeat="thread in month.threads" ng-value="thread.uri">{{thread.name}}</md-option> </md-optgroup> </md-select> </md-input-container> <div> <md-button class="md-primary md-raised" ng-click="loadCandidates(storage.tdfUri)" ng-disabled="loadingCandidates">Get candidate entries</md-button> </div> </div> <div ng-if="!months"> <p>Loading contest threads...</p> </div> <!-- <div layout="column">\r\n        <md-input-container>\r\n            <label>Enter the URL to the contest thread</label>\r\n            <input type="text" ng-model="storage.tdfUri">\r\n        </md-input-container>\r\n        <div>\r\n            <md-button class="md-primary md-raised" ng-click="loadCandidates(storage.tdfUri)">Get candidate entries</md-button>\r\n        </div>\r\n    </div> --> <div ng-if="loadingCandidates"> <p>Loading thread data...</p> </div> <div class="candidate-list" ng-if="candidates"> <p><b>{{getNumEntries()}}</b> entries included out of {{candidates.length}} candidates</p> <table> <tr> <th>Entry?</th> <th>Contestant</th> <th>Text</th> <th>Image(s)</th> <th>Doll name</th> <th>Caption</th> </tr> <tr ng-repeat="cand in candidates" class="entry" ng-class="{\'not-an-entry\': storage[cand.storageKey].isIncluded === false}"> <td> <md-checkbox ng-model="storage[cand.storageKey].isIncluded" aria-label="Check to include in output"> </md-checkbox></td> <td> {{cand.postAuthor}} </td> <td ng-bind-html="cand.postBody.text | highlight:cand"></td> <td> <md-radio-group ng-disabled="!storage[cand.storageKey].isIncluded" ng-model="storage[cand.storageKey].imageSelectionIndex"> <md-radio-button ng-repeat="uri in cand.postBody.images" ng-value="$index"> <div ng-class="{\'not-an-entry\': storage[cand.storageKey].imageSelectionIndex !== $index}"><img ng-src="{{uri}}"></div> </md-radio-button> <!-- <md-radio-button ng-value="storage[cand.storageKey].customImageUrl">\r\n                            <div><img ng-src="{{storage[cand.storageKey].customImageUrl}}"></div>\r\n                        </md-radio-button> --> </md-radio-group> </td> <td ng-class="{\'missing-info\': !storage[cand.storageKey].dollName}"> <md-input-container class="doll-name"> <label>Enter the name of the doll(s)</label> <input ng-disabled="!storage[cand.storageKey].isIncluded" type="text" ng-model="storage[cand.storageKey].dollName"> </md-input-container> </td> <td ng-class="{\'missing-info\': !storage[cand.storageKey].caption}"> <md-input-container> <label>Enter the caption</label> <input ng-disabled="!storage[cand.storageKey].isIncluded" type="text" ng-model="storage[cand.storageKey].caption"> <md-tooltip>{{storage[cand.storageKey].caption || \'unknown\'}}</md-tooltip> </md-input-container> </td> </tr> </table> </div> <div class="bb-code" ng-if="candidates"> <md-button ngclipboard data-clipboard-target="#all-bb-code">Copy to clipboard</md-button> <div> <textarea readonly id="all-bb-code" ng-value="getAllBbCode()">\r\n            </textarea> </div> </div>'),a.put("views/main.html",'<md-tabs md-dynamic-height> <md-tab label="Create a contest poll"> <contest-thread></contest-thread> </md-tab> <md-tab label="Create a winners thread"> <winners-thread></winners-thread> </md-tab> </md-tabs>')}]);